{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"space-y-6\"\n};\nconst _hoisted_2 = {\n  class: \"bg-gradient-to-br from-blue-900/20 to-purple-900/20 rounded-2xl p-8 border border-white/10\"\n};\nconst _hoisted_3 = {\n  class: \"bg-[#0D121F] rounded-xl p-6 h-[500px] overflow-y-auto mb-4 space-y-4 chat-box\"\n};\nconst _hoisted_4 = {\n  class: \"flex items-start gap-3\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"text-2xl\"\n};\nconst _hoisted_6 = {\n  class: \"flex-1\"\n};\nconst _hoisted_7 = {\n  class: \"text-sm mb-1 opacity-70\"\n};\nconst _hoisted_8 = {\n  key: 0,\n  class: \"whitespace-pre-wrap\"\n};\nconst _hoisted_9 = {\n  key: 1,\n  class: \"flex items-center gap-2\"\n};\nconst _hoisted_10 = {\n  class: \"flex gap-3\"\n};\nconst _hoisted_11 = [\"disabled\"];\nconst _hoisted_12 = [\"disabled\"];\nconst _hoisted_13 = {\n  key: 0\n};\nconst _hoisted_14 = {\n  key: 1\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[3] || (_cache[3] = _createElementVNode(\"h2\", {\n    class: \"text-3xl font-bold mb-6 flex items-center gap-3\"\n  }, [_createElementVNode(\"span\", {\n    class: \"text-4xl\"\n  }, \"ü§ñ\"), _createTextVNode(\" AI Êô∫ËÉΩÂä©Êâã \")], -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.aiMessages, (message, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: _normalizeClass([\"flex\", message.type === 'user' ? 'justify-end' : 'justify-start'])\n    }, [_createElementVNode(\"div\", {\n      class: _normalizeClass([\"max-w-[80%] rounded-2xl p-4\", message.type === 'user' ? 'bg-blue-600/30 text-white' : 'bg-gray-800/50 text-gray-200'])\n    }, [_createElementVNode(\"div\", _hoisted_4, [message.type === 'ai' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_5, \"ü§ñ\")) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"p\", _hoisted_7, _toDisplayString(message.type === 'user' ? '‰Ω†' : 'AIÂä©Êâã'), 1 /* TEXT */), message.type !== 'loading' ? (_openBlock(), _createElementBlock(\"p\", _hoisted_8, _toDisplayString(message.content), 1 /* TEXT */)) : (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [...(_cache[2] || (_cache[2] = [_createStaticVNode(\"<div class=\\\"flex gap-1\\\"><div class=\\\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\\\" style=\\\"animation-delay:0s;\\\"></div><div class=\\\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\\\" style=\\\"animation-delay:0.2s;\\\"></div><div class=\\\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\\\" style=\\\"animation-delay:0.4s;\\\"></div></div><span class=\\\"text-sm text-gray-400\\\">AI Ê≠£Âú®ÊÄùËÄÉ...</span>\", 2)]))]))])])], 2 /* CLASS */)], 2 /* CLASS */);\n  }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"div\", _hoisted_10, [_withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.aiInput = $event),\n    onKeyup: _cache[1] || (_cache[1] = _withKeys($event => !$setup.isLoading && $setup.sendAIMessage(), [\"enter\"])),\n    disabled: $setup.isLoading,\n    type: \"text\",\n    placeholder: \"ÈóÆÊàë‰ªª‰ΩïÂÖ≥‰∫éÁæéÈ£üÁöÑÈóÆÈ¢ò...\",\n    class: \"flex-1 bg-gray-800 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_11), [[_vModelText, $setup.aiInput]]), _createElementVNode(\"button\", {\n    onClick: $setup.sendAIMessage,\n    disabled: $setup.isLoading || !$setup.aiInput.trim(),\n    class: \"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-medium transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n  }, [!$setup.isLoading ? (_openBlock(), _createElementBlock(\"span\", _hoisted_13, \"ÂèëÈÄÅ\")) : (_openBlock(), _createElementBlock(\"span\", _hoisted_14, \"ÂèëÈÄÅ‰∏≠...\"))], 8 /* PROPS */, _hoisted_12)])])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_Fragment","_renderList","$setup","aiMessages","message","index","key","_normalizeClass","type","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","content","_hoisted_9","_cache","_hoisted_10","aiInput","$event","onKeyup","_withKeys","isLoading","sendAIMessage","disabled","placeholder","onClick","trim","_hoisted_13","_hoisted_14"],"sources":["/Users/leon/Desktop/Code/‰Ωú‰∏ö/webÂºÄÂèë/vue/my-food/src/components/AiAssistant.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-6\">\n    <div class=\"bg-gradient-to-br from-blue-900/20 to-purple-900/20 rounded-2xl p-8 border border-white/10\">\n      <h2 class=\"text-3xl font-bold mb-6 flex items-center gap-3\">\n        <span class=\"text-4xl\">ü§ñ</span>\n        AI Êô∫ËÉΩÂä©Êâã\n      </h2>\n\n      <div class=\"bg-[#0D121F] rounded-xl p-6 h-[500px] overflow-y-auto mb-4 space-y-4 chat-box\">\n        <div\n          v-for=\"(message, index) in aiMessages\"\n          :key=\"index\"\n          class=\"flex\"\n          :class=\"message.type === 'user' ? 'justify-end' : 'justify-start'\"\n        >\n          <div\n            class=\"max-w-[80%] rounded-2xl p-4\"\n            :class=\"message.type === 'user'\n              ? 'bg-blue-600/30 text-white'\n              : 'bg-gray-800/50 text-gray-200'\"\n          >\n            <div class=\"flex items-start gap-3\">\n              <span v-if=\"message.type === 'ai'\" class=\"text-2xl\">ü§ñ</span>\n              <div class=\"flex-1\">\n                <p class=\"text-sm mb-1 opacity-70\">\n                  {{ message.type === 'user' ? '‰Ω†' : 'AIÂä©Êâã' }}\n                </p>\n                <p v-if=\"message.type !== 'loading'\" class=\"whitespace-pre-wrap\">\n                  {{ message.content }}\n                </p>\n                <div v-else class=\"flex items-center gap-2\">\n                   <div class=\"flex gap-1\">\n                    <div class=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 0s\"></div>\n                    <div class=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 0.2s\"></div>\n                    <div class=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 0.4s\"></div>\n                  </div>\n                  <span class=\"text-sm text-gray-400\">AI Ê≠£Âú®ÊÄùËÄÉ...</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"flex gap-3\">\n        <input\n          v-model=\"aiInput\"\n          @keyup.enter=\"!isLoading && sendAIMessage()\"\n          :disabled=\"isLoading\"\n          type=\"text\"\n          placeholder=\"ÈóÆÊàë‰ªª‰ΩïÂÖ≥‰∫éÁæéÈ£üÁöÑÈóÆÈ¢ò...\"\n          class=\"flex-1 bg-gray-800 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n        />\n        <button\n          @click=\"sendAIMessage\"\n          :disabled=\"isLoading || !aiInput.trim()\"\n          class=\"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-medium transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n        >\n           <span v-if=\"!isLoading\">ÂèëÈÄÅ</span>\n           <span v-else>ÂèëÈÄÅ‰∏≠...</span>\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, nextTick } from 'vue'\nimport { chatWithAI } from '../services/openai'\n\n// 1. Êé•Êî∂Áà∂ÁªÑ‰ª∂‰º†Êù•ÁöÑÂéÜÂè≤ËÆ¢Âçï\nconst props = defineProps({\n  orderHistory: {\n    type: Array,\n    default: () => []\n  }\n})\n\nconst aiMessages = ref([\n  {\n    type: 'ai',\n    content: '‰Ω†Â•ΩÔºÅÊàëÊòØ‰Ω†ÁöÑAIÁæéÈ£üÈ°æÈóÆ„ÄÇÊàëÂ∑≤Áªè‰∫ÜËß£‰∫Ü‰Ω†ÁöÑÂè£Âë≥ÂÅèÂ•ΩÔºåÊúâ‰ªÄ‰πàÊÉ≥ÂêÉÁöÑÂêóÔºü',\n  },\n])\n\nconst aiInput = ref('')\nconst isLoading = ref(false)\n\n// 2. ÊûÑÂª∫ÂØπËØù‰∏ä‰∏ãÊñáÔºåÂåÖÂê´ÂéÜÂè≤ÂØπËØù\nconst conversationHistory = computed(() => {\n  return aiMessages.value\n    .filter((msg) => msg.type !== 'loading')\n    .map((msg) => ({\n      role: msg.type === 'user' ? 'user' : 'assistant',\n      content: msg.content,\n    }))\n    .slice(1) // ÂéªÊéâÁ¨¨‰∏ÄÊù°ÈªòËÆ§Ê¨¢ËøéËØ≠ÔºåÈÅøÂÖçÂπ≤Êâ∞\n})\n\nconst sendAIMessage = async () => {\n  if (!aiInput.value.trim() || isLoading.value) return\n\n  const userMessage = aiInput.value.trim()\n  aiInput.value = ''\n\n  // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØÂà∞ÁïåÈù¢\n  aiMessages.value.push({ type: 'user', content: userMessage })\n  \n  // Ê∑ªÂä† Loading Áä∂ÊÄÅ\n  const loadingMessageIndex = aiMessages.value.length\n  aiMessages.value.push({ type: 'loading', content: '' })\n  isLoading.value = true\n\n  // 3. Ê†∏ÂøÉÈÄªËæëÔºöÁîüÊàê‚ÄúÁ≥ªÁªüÊèêÁ§∫ËØç‚ÄùÔºåÊ≥®ÂÖ•ËÆ¢ÂçïÂéÜÂè≤\n  // Â∞ÜËÆ¢ÂçïÊï∞ÁªÑËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤Ôºå‰æãÂ¶ÇÔºö\"È∫ªÂ©ÜË±ÜËÖê, Êü†Ê™¨Ëå∂\"\n  const historyText = props.orderHistory.length > 0 \n    ? props.orderHistory.map(o => o.name).join('„ÄÅ') \n    : 'ÊöÇÊó†'\n    \n  const systemPrompt = {\n    role: 'system',\n    content: `‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑAIÁæéÈ£üÈ°æÈóÆ„ÄÇ\n    Â∑≤Áü•ËØ•Áî®Êà∑ÁöÑÂéÜÂè≤ËÆ¢ÂçïÂåÖÂê´Ôºö${historyText}„ÄÇ\n    ËØ∑Ê†πÊçÆÁî®Êà∑ÁöÑÂéÜÂè≤Âè£Âë≥ÂÅèÂ•ΩÔºà‰æãÂ¶ÇÊòØÂê¶ÂêÉËæ£„ÄÅÂñúÊ¨¢Ê∏ÖÊ∑°Á≠âÔºâÊù•ËøõË°åÊé®Ëçê„ÄÇ\n    Â¶ÇÊûúÁî®Êà∑ÈóÆÊé®Ëçê‰ªÄ‰πàÔºå‰ºòÂÖàÁªìÂêàÂéÜÂè≤ËÆ∞ÂΩïËøõË°åËÅîÊÉ≥Êé®Ëçê„ÄÇ`\n  }\n\n  // ÁªÑÂêàÊúÄÁªàÂèëÈÄÅÁªô API ÁöÑÊ∂àÊÅØÂàóË°®Ôºö[Á≥ªÁªüÊèêÁ§∫, ...ÂéÜÂè≤ÂØπËØù, Áî®Êà∑ÂΩìÂâçÈóÆÈ¢ò]\n  // Ê≥®ÊÑèÔºöËøôÈáåÊàë‰ª¨ÂÅáËÆæ chatWithAI ÂáΩÊï∞ÊîØÊåÅ‰º†ÂÖ•ÂÆåÊï¥ÁöÑ messages Êï∞ÁªÑ\n  const fullMessages = [\n    systemPrompt, \n    ...conversationHistory.value, \n    { role: 'user', content: userMessage }\n  ]\n\n  try {\n    // Ë∞ÉÁî® API\n    const response = await chatWithAI(userMessage, fullMessages)\n\n    // Êõ¥Êñ∞ÁïåÈù¢ÊòæÁ§∫\n    aiMessages.value.splice(loadingMessageIndex, 1, {\n      type: 'ai',\n      content: response,\n    })\n  } catch (error) {\n    let errorMsg = 'Êä±Ê≠âÔºåËøûÊé•Âá∫‰∫ÜÁÇπÈóÆÈ¢ò„ÄÇ'\n    // ‰∏ìÈó®Â§ÑÁêÜ Key Áº∫Â§±ÁöÑÈîôËØØÊèêÁ§∫\n    if (error.message && error.message.includes('API Key')) {\n      errorMsg = 'Êú™Ê£ÄÊµãÂà∞ÈÄö‰πâÂçÉÈóÆÂØÜÈí•ÔºåËØ∑Âú® .env.local ‰∏≠ÈÖçÁΩÆ VUE_APP_QWEN_API_KEY„ÄÇ'\n    }\n    \n    aiMessages.value.splice(loadingMessageIndex, 1, {\n      type: 'ai',\n      content: errorMsg,\n    })\n    console.error('AI Error:', error)\n  } finally {\n    isLoading.value = false\n    // ÊªöÂä®Âà∞Â∫ïÈÉ®\n    nextTick(() => {\n      const chatContainer = document.querySelector('.chat-box')\n      if (chatContainer) chatContainer.scrollTop = chatContainer.scrollHeight\n    })\n  }\n}\n</script>"],"mappings":";;EACOA,KAAK,EAAC;AAAW;;EACfA,KAAK,EAAC;AAA4F;;EAMhGA,KAAK,EAAC;AAA+E;;EAa/EA,KAAK,EAAC;AAAwB;;;EACEA,KAAK,EAAC;;;EACpCA,KAAK,EAAC;AAAQ;;EACdA,KAAK,EAAC;AAAyB;;;EAGGA,KAAK,EAAC;;;;EAG/BA,KAAK,EAAC;;;EAcvBA,KAAK,EAAC;AAAY;;;;;;;;;;uBA3C3BC,mBAAA,CA8DM,OA9DNC,UA8DM,GA7DJC,mBAAA,CA4DM,OA5DNC,UA4DM,G,0BA3DJD,mBAAA,CAGK;IAHDH,KAAK,EAAC;EAAiD,IACzDG,mBAAA,CAAgC;IAA1BH,KAAK,EAAC;EAAU,GAAC,IAAE,G,iBAAO,WAElC,E,qBAEAG,mBAAA,CAkCM,OAlCNE,UAkCM,I,kBAjCJJ,mBAAA,CAgCMK,SAAA,QAAAC,WAAA,CA/BuBC,MAAA,CAAAC,UAAU,GAA7BC,OAAO,EAAEC,KAAK;yBADxBV,mBAAA,CAgCM;MA9BHW,GAAG,EAAED,KAAK;MACXX,KAAK,EAAAa,eAAA,EAAC,MAAM,EACJH,OAAO,CAACI,IAAI;QAEpBX,mBAAA,CAyBM;MAxBJH,KAAK,EAAAa,eAAA,EAAC,6BAA6B,EAC3BH,OAAO,CAACI,IAAI,c;QAIpBX,mBAAA,CAkBM,OAlBNY,UAkBM,GAjBQL,OAAO,CAACI,IAAI,a,cAAxBb,mBAAA,CAA6D,QAA7De,UAA6D,EAAT,IAAE,K,mCACtDb,mBAAA,CAeM,OAfNc,UAeM,GAdJd,mBAAA,CAEI,KAFJe,UAEI,EAAAC,gBAAA,CADCT,OAAO,CAACI,IAAI,4CAERJ,OAAO,CAACI,IAAI,kB,cAArBb,mBAAA,CAEI,KAFJmB,UAEI,EAAAD,gBAAA,CADCT,OAAO,CAACW,OAAO,qB,cAEpBpB,mBAAA,CAOM,OAPNqB,UAOM,OAAAC,MAAA,QAAAA,MAAA,O;oCAOhBpB,mBAAA,CAiBM,OAjBNqB,WAiBM,G,gBAhBJrB,mBAAA,CAOE;+DANSK,MAAA,CAAAiB,OAAO,GAAAC,MAAA;IACfC,OAAK,EAAAJ,MAAA,QAAAA,MAAA,MAAAK,SAAA,CAAAF,MAAA,KAASlB,MAAA,CAAAqB,SAAS,IAAIrB,MAAA,CAAAsB,aAAa;IACxCC,QAAQ,EAAEvB,MAAA,CAAAqB,SAAS;IACpBf,IAAI,EAAC,MAAM;IACXkB,WAAW,EAAC,gBAAgB;IAC5BhC,KAAK,EAAC;wEALGQ,MAAA,CAAAiB,OAAO,E,GAOlBtB,mBAAA,CAOS;IANN8B,OAAK,EAAEzB,MAAA,CAAAsB,aAAa;IACpBC,QAAQ,EAAEvB,MAAA,CAAAqB,SAAS,KAAKrB,MAAA,CAAAiB,OAAO,CAACS,IAAI;IACrClC,KAAK,EAAC;OAEQQ,MAAA,CAAAqB,SAAS,I,cAAtB5B,mBAAA,CAAiC,QAAAkC,WAAA,EAAT,IAAE,M,cAC1BlC,mBAAA,CAA0B,QAAAmC,WAAA,EAAb,QAAM,G","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}