{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, computed, nextTick } from 'vue';\nimport { chatWithAI } from '../services/openai';\n\n// 1. Êé•Êî∂Áà∂ÁªÑ‰ª∂‰º†Êù•ÁöÑÂéÜÂè≤ËÆ¢Âçï\n\nexport default {\n  __name: 'AiAssistant',\n  props: {\n    orderHistory: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    /* eslint-disable no-undef */\n    const props = __props;\n    const aiMessages = ref([{\n      type: 'ai',\n      content: '‰Ω†Â•ΩÔºÅÊàëÊòØ‰Ω†ÁöÑAIÁæéÈ£üÈ°æÈóÆ„ÄÇÊàëÂ∑≤Áªè‰∫ÜËß£‰∫Ü‰Ω†ÁöÑÂè£Âë≥ÂÅèÂ•ΩÔºåÊúâ‰ªÄ‰πàÊÉ≥ÂêÉÁöÑÂêóÔºü'\n    }]);\n    const aiInput = ref('');\n    const isLoading = ref(false);\n\n    // 2. ÊûÑÂª∫ÂØπËØù‰∏ä‰∏ãÊñáÔºåÂåÖÂê´ÂéÜÂè≤ÂØπËØù\n    const conversationHistory = computed(() => {\n      return aiMessages.value.filter(msg => msg.type !== 'loading').map(msg => ({\n        role: msg.type === 'user' ? 'user' : 'assistant',\n        content: msg.content\n      })).slice(1); // ÂéªÊéâÁ¨¨‰∏ÄÊù°ÈªòËÆ§Ê¨¢ËøéËØ≠ÔºåÈÅøÂÖçÂπ≤Êâ∞\n    });\n    const sendAIMessage = async () => {\n      if (!aiInput.value.trim() || isLoading.value) return;\n      const userMessage = aiInput.value.trim();\n      aiInput.value = '';\n\n      // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØÂà∞ÁïåÈù¢\n      aiMessages.value.push({\n        type: 'user',\n        content: userMessage\n      });\n\n      // Ê∑ªÂä† Loading Áä∂ÊÄÅ\n      const loadingMessageIndex = aiMessages.value.length;\n      aiMessages.value.push({\n        type: 'loading',\n        content: ''\n      });\n      isLoading.value = true;\n\n      // 3. Ê†∏ÂøÉÈÄªËæëÔºöÁîüÊàê‚ÄúÁ≥ªÁªüÊèêÁ§∫ËØç‚ÄùÔºåÊ≥®ÂÖ•ËÆ¢ÂçïÂéÜÂè≤\n      // Â∞ÜËÆ¢ÂçïÊï∞ÁªÑËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤Ôºå‰æãÂ¶ÇÔºö\"È∫ªÂ©ÜË±ÜËÖê, Êü†Ê™¨Ëå∂\"\n      const historyText = props.orderHistory.length > 0 ? props.orderHistory.map(o => o.name).join('„ÄÅ') : 'ÊöÇÊó†';\n      const systemPrompt = {\n        role: 'system',\n        content: `‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑAIÁæéÈ£üÈ°æÈóÆ„ÄÇ\n    Â∑≤Áü•ËØ•Áî®Êà∑ÁöÑÂéÜÂè≤ËÆ¢ÂçïÂåÖÂê´Ôºö${historyText}„ÄÇ\n    ËØ∑Ê†πÊçÆÁî®Êà∑ÁöÑÂéÜÂè≤Âè£Âë≥ÂÅèÂ•ΩÔºà‰æãÂ¶ÇÊòØÂê¶ÂêÉËæ£„ÄÅÂñúÊ¨¢Ê∏ÖÊ∑°Á≠âÔºâÊù•ËøõË°åÊé®Ëçê„ÄÇ\n    Â¶ÇÊûúÁî®Êà∑ÈóÆÊé®Ëçê‰ªÄ‰πàÔºå‰ºòÂÖàÁªìÂêàÂéÜÂè≤ËÆ∞ÂΩïËøõË°åËÅîÊÉ≥Êé®Ëçê„ÄÇ`\n      };\n\n      // ÁªÑÂêàÊúÄÁªàÂèëÈÄÅÁªô API ÁöÑÊ∂àÊÅØÂàóË°®Ôºö[Á≥ªÁªüÊèêÁ§∫, ...ÂéÜÂè≤ÂØπËØù, Áî®Êà∑ÂΩìÂâçÈóÆÈ¢ò]\n      // Ê≥®ÊÑèÔºöËøôÈáåÊàë‰ª¨ÂÅáËÆæ chatWithAI ÂáΩÊï∞ÊîØÊåÅ‰º†ÂÖ•ÂÆåÊï¥ÁöÑ messages Êï∞ÁªÑ\n      const fullMessages = [systemPrompt, ...conversationHistory.value, {\n        role: 'user',\n        content: userMessage\n      }];\n      try {\n        // Ë∞ÉÁî® API\n        const response = await chatWithAI(userMessage, fullMessages);\n\n        // Êõ¥Êñ∞ÁïåÈù¢ÊòæÁ§∫\n        aiMessages.value.splice(loadingMessageIndex, 1, {\n          type: 'ai',\n          content: response\n        });\n      } catch (error) {\n        let errorMsg = 'Êä±Ê≠âÔºåËøûÊé•Âá∫‰∫ÜÁÇπÈóÆÈ¢ò„ÄÇ';\n        // ‰∏ìÈó®Â§ÑÁêÜ Key Áº∫Â§±ÁöÑÈîôËØØÊèêÁ§∫\n        if (error.message && error.message.includes('API Key')) {\n          errorMsg = 'Êú™Ê£ÄÊµãÂà∞ÈÄö‰πâÂçÉÈóÆÂØÜÈí•ÔºåËØ∑Âú® .env.local ‰∏≠ÈÖçÁΩÆ VUE_APP_QWEN_API_KEY„ÄÇ';\n        }\n        aiMessages.value.splice(loadingMessageIndex, 1, {\n          type: 'ai',\n          content: errorMsg\n        });\n        console.error('AI Error:', error);\n      } finally {\n        isLoading.value = false;\n        // ÊªöÂä®Âà∞Â∫ïÈÉ®\n        nextTick(() => {\n          const chatContainer = document.querySelector('.chat-box');\n          if (chatContainer) chatContainer.scrollTop = chatContainer.scrollHeight;\n        });\n      }\n    };\n    const __returned__ = {\n      props,\n      aiMessages,\n      aiInput,\n      isLoading,\n      conversationHistory,\n      sendAIMessage,\n      ref,\n      computed,\n      nextTick,\n      get chatWithAI() {\n        return chatWithAI;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","nextTick","chatWithAI","props","__props","aiMessages","type","content","aiInput","isLoading","conversationHistory","value","filter","msg","map","role","slice","sendAIMessage","trim","userMessage","push","loadingMessageIndex","length","historyText","orderHistory","o","name","join","systemPrompt","fullMessages","response","splice","error","errorMsg","message","includes","console","chatContainer","document","querySelector","scrollTop","scrollHeight"],"sources":["/Users/leon/Desktop/Code/‰Ωú‰∏ö/webÂºÄÂèë/vue/my-food/src/components/AiAssistant.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-6\">\n    <div class=\"bg-gradient-to-br from-blue-900/20 to-purple-900/20 rounded-2xl p-8 border border-white/10\">\n      <h2 class=\"text-3xl font-bold mb-6 flex items-center gap-3\">\n        <span class=\"text-4xl\">ü§ñ</span>\n        AI Êô∫ËÉΩÂä©Êâã\n      </h2>\n\n      <div class=\"bg-[#0D121F] rounded-xl p-6 h-[500px] overflow-y-auto mb-4 space-y-4 chat-box\">\n        <div\n          v-for=\"(message, index) in aiMessages\"\n          :key=\"index\"\n          class=\"flex\"\n          :class=\"message.type === 'user' ? 'justify-end' : 'justify-start'\"\n        >\n          <div\n            class=\"max-w-[80%] rounded-2xl p-4\"\n            :class=\"message.type === 'user'\n              ? 'bg-blue-600/30 text-white'\n              : 'bg-gray-800/50 text-gray-200'\"\n          >\n            <div class=\"flex items-start gap-3\">\n              <span v-if=\"message.type === 'ai'\" class=\"text-2xl\">ü§ñ</span>\n              <div class=\"flex-1\">\n                <p class=\"text-sm mb-1 opacity-70\">\n                  {{ message.type === 'user' ? '‰Ω†' : 'AIÂä©Êâã' }}\n                </p>\n                <p v-if=\"message.type !== 'loading'\" class=\"whitespace-pre-wrap\">\n                  {{ message.content }}\n                </p>\n                <div v-else class=\"flex items-center gap-2\">\n                   <div class=\"flex gap-1\">\n                    <div class=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 0s\"></div>\n                    <div class=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 0.2s\"></div>\n                    <div class=\"w-2 h-2 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 0.4s\"></div>\n                  </div>\n                  <span class=\"text-sm text-gray-400\">AI Ê≠£Âú®ÊÄùËÄÉ...</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"flex gap-3\">\n        <input\n          v-model=\"aiInput\"\n          @keyup.enter=\"!isLoading && sendAIMessage()\"\n          :disabled=\"isLoading\"\n          type=\"text\"\n          placeholder=\"ÈóÆÊàë‰ªª‰ΩïÂÖ≥‰∫éÁæéÈ£üÁöÑÈóÆÈ¢ò...\"\n          class=\"flex-1 bg-gray-800 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n        />\n        <button\n          @click=\"sendAIMessage\"\n          :disabled=\"isLoading || !aiInput.trim()\"\n          class=\"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-medium transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n        >\n           <span v-if=\"!isLoading\">ÂèëÈÄÅ</span>\n           <span v-else>ÂèëÈÄÅ‰∏≠...</span>\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\n/* eslint-disable no-undef */\nimport { ref, computed, nextTick } from 'vue'\nimport { chatWithAI } from '../services/openai'\n\n// 1. Êé•Êî∂Áà∂ÁªÑ‰ª∂‰º†Êù•ÁöÑÂéÜÂè≤ËÆ¢Âçï\nconst props = defineProps({\n  orderHistory: {\n    type: Array,\n    default: () => []\n  }\n})\n\nconst aiMessages = ref([\n  {\n    type: 'ai',\n    content: '‰Ω†Â•ΩÔºÅÊàëÊòØ‰Ω†ÁöÑAIÁæéÈ£üÈ°æÈóÆ„ÄÇÊàëÂ∑≤Áªè‰∫ÜËß£‰∫Ü‰Ω†ÁöÑÂè£Âë≥ÂÅèÂ•ΩÔºåÊúâ‰ªÄ‰πàÊÉ≥ÂêÉÁöÑÂêóÔºü',\n  },\n])\n\nconst aiInput = ref('')\nconst isLoading = ref(false)\n\n// 2. ÊûÑÂª∫ÂØπËØù‰∏ä‰∏ãÊñáÔºåÂåÖÂê´ÂéÜÂè≤ÂØπËØù\nconst conversationHistory = computed(() => {\n  return aiMessages.value\n    .filter((msg) => msg.type !== 'loading')\n    .map((msg) => ({\n      role: msg.type === 'user' ? 'user' : 'assistant',\n      content: msg.content,\n    }))\n    .slice(1) // ÂéªÊéâÁ¨¨‰∏ÄÊù°ÈªòËÆ§Ê¨¢ËøéËØ≠ÔºåÈÅøÂÖçÂπ≤Êâ∞\n})\n\nconst sendAIMessage = async () => {\n  if (!aiInput.value.trim() || isLoading.value) return\n\n  const userMessage = aiInput.value.trim()\n  aiInput.value = ''\n\n  // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØÂà∞ÁïåÈù¢\n  aiMessages.value.push({ type: 'user', content: userMessage })\n  \n  // Ê∑ªÂä† Loading Áä∂ÊÄÅ\n  const loadingMessageIndex = aiMessages.value.length\n  aiMessages.value.push({ type: 'loading', content: '' })\n  isLoading.value = true\n\n  // 3. Ê†∏ÂøÉÈÄªËæëÔºöÁîüÊàê‚ÄúÁ≥ªÁªüÊèêÁ§∫ËØç‚ÄùÔºåÊ≥®ÂÖ•ËÆ¢ÂçïÂéÜÂè≤\n  // Â∞ÜËÆ¢ÂçïÊï∞ÁªÑËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤Ôºå‰æãÂ¶ÇÔºö\"È∫ªÂ©ÜË±ÜËÖê, Êü†Ê™¨Ëå∂\"\n  const historyText = props.orderHistory.length > 0 \n    ? props.orderHistory.map(o => o.name).join('„ÄÅ') \n    : 'ÊöÇÊó†'\n    \n  const systemPrompt = {\n    role: 'system',\n    content: `‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑAIÁæéÈ£üÈ°æÈóÆ„ÄÇ\n    Â∑≤Áü•ËØ•Áî®Êà∑ÁöÑÂéÜÂè≤ËÆ¢ÂçïÂåÖÂê´Ôºö${historyText}„ÄÇ\n    ËØ∑Ê†πÊçÆÁî®Êà∑ÁöÑÂéÜÂè≤Âè£Âë≥ÂÅèÂ•ΩÔºà‰æãÂ¶ÇÊòØÂê¶ÂêÉËæ£„ÄÅÂñúÊ¨¢Ê∏ÖÊ∑°Á≠âÔºâÊù•ËøõË°åÊé®Ëçê„ÄÇ\n    Â¶ÇÊûúÁî®Êà∑ÈóÆÊé®Ëçê‰ªÄ‰πàÔºå‰ºòÂÖàÁªìÂêàÂéÜÂè≤ËÆ∞ÂΩïËøõË°åËÅîÊÉ≥Êé®Ëçê„ÄÇ`\n  }\n\n  // ÁªÑÂêàÊúÄÁªàÂèëÈÄÅÁªô API ÁöÑÊ∂àÊÅØÂàóË°®Ôºö[Á≥ªÁªüÊèêÁ§∫, ...ÂéÜÂè≤ÂØπËØù, Áî®Êà∑ÂΩìÂâçÈóÆÈ¢ò]\n  // Ê≥®ÊÑèÔºöËøôÈáåÊàë‰ª¨ÂÅáËÆæ chatWithAI ÂáΩÊï∞ÊîØÊåÅ‰º†ÂÖ•ÂÆåÊï¥ÁöÑ messages Êï∞ÁªÑ\n  const fullMessages = [\n    systemPrompt, \n    ...conversationHistory.value, \n    { role: 'user', content: userMessage }\n  ]\n\n  try {\n    // Ë∞ÉÁî® API\n    const response = await chatWithAI(userMessage, fullMessages)\n\n    // Êõ¥Êñ∞ÁïåÈù¢ÊòæÁ§∫\n    aiMessages.value.splice(loadingMessageIndex, 1, {\n      type: 'ai',\n      content: response,\n    })\n  } catch (error) {\n    let errorMsg = 'Êä±Ê≠âÔºåËøûÊé•Âá∫‰∫ÜÁÇπÈóÆÈ¢ò„ÄÇ'\n    // ‰∏ìÈó®Â§ÑÁêÜ Key Áº∫Â§±ÁöÑÈîôËØØÊèêÁ§∫\n    if (error.message && error.message.includes('API Key')) {\n      errorMsg = 'Êú™Ê£ÄÊµãÂà∞ÈÄö‰πâÂçÉÈóÆÂØÜÈí•ÔºåËØ∑Âú® .env.local ‰∏≠ÈÖçÁΩÆ VUE_APP_QWEN_API_KEY„ÄÇ'\n    }\n    \n    aiMessages.value.splice(loadingMessageIndex, 1, {\n      type: 'ai',\n      content: errorMsg,\n    })\n    console.error('AI Error:', error)\n  } finally {\n    isLoading.value = false\n    // ÊªöÂä®Âà∞Â∫ïÈÉ®\n    nextTick(() => {\n      const chatContainer = document.querySelector('.chat-box')\n      if (chatContainer) chatContainer.scrollTop = chatContainer.scrollHeight\n    })\n  }\n}\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}